<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Algebra Tiles - Drag and Drop</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* Skip to main content link */
        .skip-link {
            position: absolute;
            top: -40px;
            left: 0;
            background: #000;
            color: white;
            padding: 8px;
            text-decoration: none;
            z-index: 100;
        }

        .skip-link:focus {
            top: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        h1 {
            color: white;
            text-align: center;
            margin-bottom: 10px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .subtitle {
            color: rgba(255,255,255,0.9);
            text-align: center;
            margin-bottom: 30px;
            font-size: 1.1em;
        }

        .workspace {
            display: grid;
            grid-template-columns: 280px 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .palette {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .palette h2 {
            font-size: 1.3em;
            margin-bottom: 15px;
            color: #333;
        }

        .tile-group {
            margin-bottom: 25px;
        }

        .tile-group h3 {
            font-size: 1em;
            margin-bottom: 10px;
            color: #666;
            font-weight: 600;
        }

        .palette-tiles {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .tile-row {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .tile-controls {
            display: flex;
            flex-direction: column;
            gap: 5px;
            flex: 1;
        }

        .quantity-control {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .quantity-input {
            width: 50px;
            padding: 5px 8px;
            border: 2px solid #ddd;
            border-radius: 4px;
            font-size: 0.9em;
            text-align: center;
        }

        .add-btn {
            padding: 5px 12px;
            background: #27ae60;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 0.85em;
            cursor: pointer;
            white-space: nowrap;
            transition: background 0.2s;
        }

        .add-btn:hover {
            background: #229954;
        }

        .add-btn:active {
            transform: scale(0.95);
        }

        .canvas {
            background: white;
            border-radius: 12px;
            min-height: 600px;
            position: relative;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .tile {
            position: absolute;
            cursor: move;
            border: 2px solid rgba(0,0,0,0.3);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: rgba(0,0,0,0.7);
            user-select: none;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            transition: box-shadow 0.1s;
        }

        .tile:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        .tile.dragging {
            opacity: 0.7;
            z-index: 1000;
        }

        .tile.selected {
            outline: 3px solid #9b59b6;
            outline-offset: 2px;
        }

        /* Positive tiles - Blue (colorblind friendly) */
        .tile.x2-pos { 
            background: #4A90E2;
            width: 100px;
            height: 100px;
        }

        .tile.x-pos { 
            background: #4A90E2;
            width: 100px;
            height: 10px;
        }

        .tile.unit-pos { 
            background: #4A90E2;
            width: 10px;
            height: 10px;
        }

        /* Negative tiles - Orange (colorblind friendly contrast to blue) */
        .tile.x2-neg { 
            background: #E8833A;
            width: 100px;
            height: 100px;
        }

        .tile.x-neg { 
            background: #E8833A;
            width: 100px;
            height: 10px;
        }

        .tile.unit-neg { 
            background: #E8833A;
            width: 10px;
            height: 10px;
        }

        .palette-tile {
            position: relative;
            cursor: pointer;
            border: 2px solid rgba(0,0,0,0.3);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: rgba(0,0,0,0.7);
            user-select: none;
            box-shadow: 0 2px 6px rgba(0,0,0,0.15);
            transition: all 0.2s;
            margin: 0 auto;
        }

        .palette-tile:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.25);
        }

        .palette-tile:active {
            transform: scale(0.95);
        }

        .palette-tile.x2-pos,
        .palette-tile.x2-neg {
            width: 80px;
            height: 80px;
        }

        .palette-tile.x-pos,
        .palette-tile.x-neg {
            width: 80px;
            height: 10px;
        }

        .palette-tile.unit-pos,
        .palette-tile.unit-neg {
            width: 10px;
            height: 10px;
        }

        .controls {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            display: flex;
            justify-content: center;
            gap: 15px;
        }

        button {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 2px 6px rgba(0,0,0,0.15);
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.25);
        }

        button:active {
            transform: scale(0.98);
        }

        .menu-btn {
            background: #95a5a6;
            color: white;
        }

        .menu-btn:hover {
            background: #7f8c8d;
        }

        .clear-btn {
            background: #e74c3c;
            color: white;
        }

        .clear-btn:hover {
            background: #c0392b;
        }

        .rotate-btn {
            background: #3498db;
            color: white;
        }

        .rotate-btn:hover {
            background: #2980b9;
        }

        .rotate-btn:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
        }

        .calculate-btn {
            background: #9b59b6;
            color: white;
        }

        .calculate-btn:hover {
            background: #8e44ad;
        }

        .result-display {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            margin-top: 20px;
            text-align: center;
            min-height: 80px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .result-label {
            font-size: 1.1em;
            color: #666;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .result-value {
            font-size: 2em;
            color: #2c3e50;
            font-weight: bold;
            font-family: 'Courier New', monospace;
        }

        .result-empty {
            color: #999;
            font-style: italic;
        }

        .legend {
            background: rgba(255,255,255,0.95);
            border-radius: 8px;
            padding: 15px;
            margin-top: 10px;
            font-size: 0.9em;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
        }

        .legend-color {
            width: 30px;
            height: 20px;
            border: 2px solid rgba(0,0,0,0.3);
            border-radius: 3px;
        }

        .info-box {
            background: rgba(255,255,255,0.15);
            backdrop-filter: blur(10px);
            border-radius: 8px;
            padding: 15px;
            color: white;
            text-align: center;
            margin-bottom: 20px;
            border: 1px solid rgba(255,255,255,0.3);
        }

        /* Focus styles for accessibility */
        button:focus,
        .palette-tile:focus,
        .quantity-input:focus {
            outline: 3px solid #fff;
            outline-offset: 2px;
        }

        /* High contrast mode support */
        @media (prefers-contrast: high) {
            .tile {
                border: 3px solid #000;
            }
        }

        /* Reduced motion support */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* Screen reader only class */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border-width: 0;
        }
    </style>
</head>
<body>
    <a href="#main-content" class="skip-link">Skip to main content</a>
    <div class="container">
        <header>
            <h1>ðŸ§® Algebra Tiles</h1>
            <p class="subtitle">Drag tiles from the palette to the workspace to visualize algebraic expressions</p>
        </header>
        
        <div class="info-box" role="status" aria-live="polite">
            ðŸ’¡ Click tiles to select, then use <strong>arrow keys</strong> to move (Shift+Arrow for larger steps). Right-click or press <strong>R</strong> to rotate x tiles. Press <strong>Delete</strong> to remove selected tile.
        </div>

        <main id="main-content">
            <div class="workspace">
                <aside class="palette" aria-label="Tile palette">
                    <h2>Tile Palette</h2>
                
                <div class="tile-group">
                    <h3>Positive (Blue)</h3>
                    <div class="palette-tiles">
                        <div class="tile-row">
                            <div class="palette-tile x2-pos" data-type="x2-pos">xÂ²</div>
                            <div class="tile-controls">
                                <div style="font-size: 0.9em;">xÂ² tile</div>
                                <div class="quantity-control">
                                    <input type="number" class="quantity-input" id="qty-x2-pos" min="1" max="20" value="1">
                                    <button class="add-btn" onclick="addMultipleTiles('x2-pos', 'qty-x2-pos')">Add</button>
                                </div>
                            </div>
                        </div>
                        <div class="tile-row">
                            <div class="palette-tile x-pos" data-type="x-pos">x</div>
                            <div class="tile-controls">
                                <div style="font-size: 0.9em;">x tile</div>
                                <div class="quantity-control">
                                    <input type="number" class="quantity-input" id="qty-x-pos" min="1" max="20" value="1">
                                    <button class="add-btn" onclick="addMultipleTiles('x-pos', 'qty-x-pos')">Add</button>
                                </div>
                            </div>
                        </div>
                        <div class="tile-row">
                            <div class="palette-tile unit-pos" data-type="unit-pos"></div>
                            <div class="tile-controls">
                                <div style="font-size: 0.9em;">1 tile</div>
                                <div class="quantity-control">
                                    <input type="number" class="quantity-input" id="qty-unit-pos" min="1" max="20" value="1">
                                    <button class="add-btn" onclick="addMultipleTiles('unit-pos', 'qty-unit-pos')">Add</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="tile-group">
                    <h3>Negative (Orange)</h3>
                    <div class="palette-tiles">
                        <div class="tile-row">
                            <div class="palette-tile x2-neg" data-type="x2-neg">-xÂ²</div>
                            <div class="tile-controls">
                                <div style="font-size: 0.9em;">-xÂ² tile</div>
                                <div class="quantity-control">
                                    <input type="number" class="quantity-input" id="qty-x2-neg" min="1" max="20" value="1">
                                    <button class="add-btn" onclick="addMultipleTiles('x2-neg', 'qty-x2-neg')">Add</button>
                                </div>
                            </div>
                        </div>
                        <div class="tile-row">
                            <div class="palette-tile x-neg" data-type="x-neg">-x</div>
                            <div class="tile-controls">
                                <div style="font-size: 0.9em;">-x tile</div>
                                <div class="quantity-control">
                                    <input type="number" class="quantity-input" id="qty-x-neg" min="1" max="20" value="1">
                                    <button class="add-btn" onclick="addMultipleTiles('x-neg', 'qty-x-neg')">Add</button>
                                </div>
                            </div>
                        </div>
                        <div class="tile-row">
                            <div class="palette-tile unit-neg" data-type="unit-neg"></div>
                            <div class="tile-controls">
                                <div style="font-size: 0.9em;">-1 tile</div>
                                <div class="quantity-control">
                                    <input type="number" class="quantity-input" id="qty-unit-neg" min="1" max="20" value="1">
                                    <button class="add-btn" onclick="addMultipleTiles('unit-neg', 'qty-unit-neg')">Add</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="legend">
                    <strong>Color Legend:</strong>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #4A90E2;"></div>
                        <span>Positive values</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #E8833A;"></div>
                        <span>Negative values</span>
                    </div>
                    <hr style="margin: 10px 0; border: none; border-top: 1px solid #ddd;">
                    <strong>Keyboard Shortcuts:</strong>
                    <div style="font-size: 0.85em; margin-top: 5px; line-height: 1.6;">
                        <div>â€¢ Arrow Keys: Move tile</div>
                        <div>â€¢ Shift + Arrow: Move faster</div>
                        <div>â€¢ R: Rotate x tiles</div>
                        <div>â€¢ Delete/Backspace: Remove tile</div>
                    </div>
                </div>
            </aside>

            <div class="canvas" 
                 id="canvas" 
                 role="application" 
                 aria-label="Algebra tiles workspace. Use arrow keys to move selected tiles."
                 tabindex="0">
                <!-- Tiles will be added here -->
            </div>
        </div>

        <div class="controls" role="toolbar" aria-label="Workspace controls">
            <button class="rotate-btn" 
                    id="rotateBtn" 
                    onclick="rotateSelected()" 
                    disabled
                    aria-label="Rotate selected x tile 90 degrees">Rotate Selected Tile</button>
            <button class="calculate-btn" 
                    onclick="calculateTotal()"
                    aria-label="Calculate total expression from all tiles">Calculate Total</button>
            <button class="clear-btn" 
                    onclick="clearCanvas()"
                    aria-label="Clear all tiles from workspace">Clear Workspace</button>
            <button class="menu-btn" 
                    onclick="goToMenu()"
                    aria-label="Return to main menu">Main Menu</button>
        </div>

        <div class="result-display" 
             id="resultDisplay" 
             role="region" 
             aria-live="polite" 
             aria-label="Calculation result">
            <div class="result-label">Total Expression:</div>
            <div class="result-value result-empty">No tiles in workspace</div>
        </div>
        </main>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const rotateBtn = document.getElementById('rotateBtn');
        let draggedElement = null;
        let selectedTile = null;
        let offsetX = 0;
        let offsetY = 0;
        let tileCounter = 0;
        let isDragging = false;

        // Add tile to canvas - SIMPLIFIED VERSION
        function createTile(type, x, y) {
            const tile = document.createElement('div');
            tile.className = `tile ${type}`;
            tile.style.left = x + 'px';
            tile.style.top = y + 'px';
            tile.dataset.id = tileCounter++;
            tile.dataset.rotation = '0';
            
            // Add label based on type
            const labels = {
                'x2-pos': 'xÂ²',
                'x-pos': 'x',
                'unit-pos': '1',
                'x2-neg': '-xÂ²',
                'x-neg': '-x',
                'unit-neg': '-1'
            };
            
            tile.textContent = labels[type];
            
            canvas.appendChild(tile);
            return tile;
        }

        // Simplified event delegation - ONE LISTENER on canvas
        canvas.addEventListener('mousedown', function(e) {
            if (e.target.classList.contains('tile') && e.button === 0) {
                e.preventDefault();
                selectTile(e.target);
                startDrag(e.target, e);
            } else if (e.target === canvas) {
                // Clicked empty canvas area
                if (selectedTile) {
                    selectedTile.classList.remove('selected');
                    selectedTile = null;
                    updateRotateButton();
                }
            }
        });

        // Right click for rotation
        canvas.addEventListener('contextmenu', function(e) {
            if (e.target.classList.contains('tile')) {
                e.preventDefault();
                const tile = e.target;
                if (tile.classList.contains('x-pos') || tile.classList.contains('x-neg')) {
                    rotateTile(tile);
                }
            }
        });

        // Double click to remove
        canvas.addEventListener('dblclick', function(e) {
            if (e.target.classList.contains('tile')) {
                if (selectedTile === e.target) {
                    selectedTile = null;
                    updateRotateButton();
                }
                e.target.remove();
            }
        });

        // Select a tile
        function selectTile(tile) {
            if (selectedTile) {
                selectedTile.classList.remove('selected');
            }
            selectedTile = tile;
            selectedTile.classList.add('selected');
            updateRotateButton();
        }

        // Update rotate button state
        function updateRotateButton() {
            if (selectedTile && (selectedTile.classList.contains('x-pos') || selectedTile.classList.contains('x-neg'))) {
                rotateBtn.disabled = false;
            } else {
                rotateBtn.disabled = true;
            }
        }

        // Rotate a tile
        function rotateTile(tile) {
            const currentRotation = parseInt(tile.dataset.rotation) || 0;
            const newRotation = (currentRotation + 90) % 360;
            tile.dataset.rotation = newRotation;
            
            if (newRotation === 90 || newRotation === 270) {
                tile.style.transform = `rotate(${newRotation}deg)`;
            } else {
                tile.style.transform = 'none';
            }
        }

        // Rotate selected tile
        function rotateSelected() {
            if (selectedTile && (selectedTile.classList.contains('x-pos') || selectedTile.classList.contains('x-neg'))) {
                rotateTile(selectedTile);
            }
        }

        // Start drag
        function startDrag(tile, e) {
            isDragging = true;
            draggedElement = tile;
            
            const rect = tile.getBoundingClientRect();
            offsetX = e.clientX - rect.left;
            offsetY = e.clientY - rect.top;
            
            tile.classList.add('dragging');
        }

        // Global mouse move handler
        document.addEventListener('mousemove', function(e) {
            if (!isDragging || !draggedElement) return;
            
            e.preventDefault();
            const canvasRect = canvas.getBoundingClientRect();
            
            let newX = e.clientX - canvasRect.left - offsetX;
            let newY = e.clientY - canvasRect.top - offsetY;
            
            // Keep within canvas bounds
            newX = Math.max(0, Math.min(newX, canvasRect.width - draggedElement.offsetWidth));
            newY = Math.max(0, Math.min(newY, canvasRect.height - draggedElement.offsetHeight));
            
            draggedElement.style.left = newX + 'px';
            draggedElement.style.top = newY + 'px';
        });

        // Global mouse up handler
        document.addEventListener('mouseup', function() {
            if (draggedElement) {
                draggedElement.classList.remove('dragging');
                draggedElement = null;
            }
            isDragging = false;
        });

        // Palette tile click handler
        document.querySelectorAll('.palette-tile').forEach(paletteTile => {
            paletteTile.addEventListener('click', function(e) {
                const type = this.dataset.type;
                const canvasRect = canvas.getBoundingClientRect();
                
                // Create tile in center of canvas with some randomness
                const x = (canvasRect.width / 2) - 50 + (Math.random() - 0.5) * 100;
                const y = (canvasRect.height / 2) - 50 + (Math.random() - 0.5) * 100;
                
                createTile(type, x, y);
            });
        });

        // Add multiple tiles to canvas
        function addMultipleTiles(type, inputId) {
            const input = document.getElementById(inputId);
            let quantity = parseInt(input.value);
            
            if (isNaN(quantity) || quantity < 1) {
                alert('Please enter a valid number (1 or more)');
                input.value = 1;
                return;
            }
            
            if (quantity > 20) {
                alert('Maximum 20 tiles at once to prevent performance issues');
                input.value = 20;
                quantity = 20;
            }
            
            const canvasRect = canvas.getBoundingClientRect();
            const centerX = canvasRect.width / 2;
            const centerY = canvasRect.height / 2;
            
            // Get tile dimensions based on type
            let tileWidth, tileHeight;
            if (type.includes('x2')) {
                tileWidth = 100;
                tileHeight = 100;
            } else if (type.includes('x-')) {
                tileWidth = 100;
                tileHeight = 10;
            } else {
                tileWidth = 10;
                tileHeight = 10;
            }
            
            const tilesPerRow = Math.min(Math.ceil(Math.sqrt(quantity)), 10);
            const spacing = 15;
            
            const numRows = Math.ceil(quantity / tilesPerRow);
            const gridWidth = tilesPerRow * (tileWidth + spacing);
            const gridHeight = numRows * (tileHeight + spacing);
            
            const startX = Math.max(50, centerX - gridWidth / 2);
            const startY = Math.max(50, centerY - gridHeight / 2);
            
            // Add tiles immediately in a batch (no setTimeout)
            for (let i = 0; i < quantity; i++) {
                const row = Math.floor(i / tilesPerRow);
                const col = i % tilesPerRow;
                
                const x = startX + col * (tileWidth + spacing);
                const y = startY + row * (tileHeight + spacing);
                
                if (x >= 0 && y >= 0 && x < canvasRect.width - tileWidth && y < canvasRect.height - tileHeight) {
                    createTile(type, x, y);
                }
            }
        }

        // Handle arrow key movement - PREVENT DEFAULT IMMEDIATELY
        document.addEventListener('keydown', function(e) {
            // CRITICAL: Prevent default for arrow keys FIRST
            if (['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'].includes(e.key)) {
                e.preventDefault();
                e.stopPropagation();
                
                // Only move if a tile is selected
                if (!selectedTile) return;
                
                const moveAmount = e.shiftKey ? 10 : 1;
                const canvasRect = canvas.getBoundingClientRect();
                
                let currentLeft = parseFloat(selectedTile.style.left) || 0;
                let currentTop = parseFloat(selectedTile.style.top) || 0;
                
                switch(e.key) {
                    case 'ArrowLeft':
                        currentLeft = Math.max(0, currentLeft - moveAmount);
                        selectedTile.style.left = currentLeft + 'px';
                        break;
                    case 'ArrowRight':
                        currentLeft = Math.min(canvasRect.width - selectedTile.offsetWidth, currentLeft + moveAmount);
                        selectedTile.style.left = currentLeft + 'px';
                        break;
                    case 'ArrowUp':
                        currentTop = Math.max(0, currentTop - moveAmount);
                        selectedTile.style.top = currentTop + 'px';
                        break;
                    case 'ArrowDown':
                        currentTop = Math.min(canvasRect.height - selectedTile.offsetHeight, currentTop + moveAmount);
                        selectedTile.style.top = currentTop + 'px';
                        break;
                }
                return;
            }
            
            // Only process other keys if a tile is selected
            if (!selectedTile) return;
            
            switch(e.key) {
                case 'Delete':
                case 'Backspace':
                    e.preventDefault();
                    selectedTile.remove();
                    selectedTile = null;
                    updateRotateButton();
                    break;
                case 'r':
                case 'R':
                    if (selectedTile.classList.contains('x-pos') || selectedTile.classList.contains('x-neg')) {
                        rotateTile(selectedTile);
                    }
                    break;
            }
        });

        function clearCanvas() {
            canvas.innerHTML = '';
            selectedTile = null;
            updateRotateButton();
            document.querySelector('.result-value').textContent = 'No tiles in workspace';
            document.querySelector('.result-value').className = 'result-value result-empty';
        }

        function goToMenu() {
            if (confirm('Return to main menu?')) {
                window.location.href = 'index.html';
            }
        }

        function calculateTotal() {
            const tiles = canvas.querySelectorAll('.tile');
            
            if (tiles.length === 0) {
                document.querySelector('.result-value').textContent = 'No tiles in workspace';
                document.querySelector('.result-value').className = 'result-value result-empty';
                return;
            }
            
            let x2Count = 0;
            let xCount = 0;
            let unitCount = 0;
            
            tiles.forEach(tile => {
                if (tile.classList.contains('x2-pos')) {
                    x2Count++;
                } else if (tile.classList.contains('x2-neg')) {
                    x2Count--;
                } else if (tile.classList.contains('x-pos')) {
                    xCount++;
                } else if (tile.classList.contains('x-neg')) {
                    xCount--;
                } else if (tile.classList.contains('unit-pos')) {
                    unitCount++;
                } else if (tile.classList.contains('unit-neg')) {
                    unitCount--;
                }
            });
            
            // Build the expression
            let expression = '';
            
            // Add xÂ² terms
            if (x2Count !== 0) {
                if (x2Count === 1) {
                    expression += 'xÂ²';
                } else if (x2Count === -1) {
                    expression += '-xÂ²';
                } else {
                    expression += x2Count + 'xÂ²';
                }
            }
            
            // Add x terms
            if (xCount !== 0) {
                if (expression !== '' && xCount > 0) {
                    expression += ' + ';
                } else if (expression !== '' && xCount < 0) {
                    expression += ' - ';
                    xCount = Math.abs(xCount);
                }
                
                if (xCount === 1 && expression === '') {
                    expression += 'x';
                } else if (xCount === 1) {
                    expression += 'x';
                } else if (xCount === -1) {
                    expression += '-x';
                } else {
                    expression += xCount + 'x';
                }
            }
            
            // Add unit terms
            if (unitCount !== 0) {
                if (expression !== '' && unitCount > 0) {
                    expression += ' + ' + unitCount;
                } else if (expression !== '' && unitCount < 0) {
                    expression += ' - ' + Math.abs(unitCount);
                } else {
                    expression += unitCount;
                }
            }
            
            // Handle case where all counts are 0
            if (expression === '') {
                expression = '0';
            }
            
            document.querySelector('.result-value').textContent = expression;
            document.querySelector('.result-value').className = 'result-value';
        }

        // Prevent default drag behavior
        document.addEventListener('dragstart', (e) => e.preventDefault());
    </script>
</body>
</html>
